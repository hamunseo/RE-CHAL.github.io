<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>디자인 가이드 카드 제출</title>
  <link rel="stylesheet" href="style5.css" />
  
</head>
<body>
  <div class="container">
    <!-- 헤더 -->
    <div class="nav-bar">
      <img src="image/logo.png" alt="로고" class="logo">
      <ul class="menu">
        <li><a href="#">챌린지</a></li>
        <li><a href="#">라이브러리</a></li>
        <li><a href="#">프로필페이지</a></li>
      </ul>
    </div>

    <!-- 메인 콘텐츠 -->
    <div class="innerbox">
      <!-- 왼쪽: 선택된 가이드 카드 미리보기 -->
      <div class="guide-preview">
        <h2>디자인 가이드 카드</h2>
        <div class="cardbox" id="preview-card">
          <!-- JS로 여기에 index4에서 선택한 카드 내용이 주입됩니다 -->
        </div>
      </div>

      <!-- 오른쪽: 업로드 & 설명 -->
      <div class="submit-zone">
        <div class="image-upload">
            <div class="description">
                <h3>이미지 업로드</h3>
                <p>해당 과제를 해결할 시각적 결과물을 업로드 하세요.</p>
            </div>
          <div class="upload-dropzone" id="dropzone">
            <span class="placeholder">
              클릭 또는 드래그하여<br>이미지를 선택하세요
            </span>
            <input type="file" id="fileInput" accept="image/*" multiple />
          </div>
        </div>
        <div class="task-desc">
          <div class="description">
            <h3>과제 설명</h3>
            <p>해당 과제를 해결할 시각적 결과물을 업로드 하세요.</p>
        </div>
          <textarea placeholder="해당 과제를 해결하게 된 과정에 대한 설명을 작성하세요."></textarea>
        </div>
      </div>
    </div>
    <div class="floating-nav">
      <button class="prev-btn">← 이전으로</button>
      <button class="next-btn">제출하기</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

    // 1) Firebase 초기화
    const firebaseConfig = {
      apiKey: "AIzaSyD8C0r8KaBck2olZ-6lab7nr3pV3sHtlNM",
      authDomain: "design-cha.firebaseapp.com",
      projectId: "design-cha",
      storageBucket: "design-cha.firebasestorage.app",
      messagingSenderId: "880464166610",
      appId: "1:880464166610:web:85a490dced53ed0e31370b"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // 2) URL에서 id 파라미터 꺼내기
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    // 3) 미리보기 렌더링
    async function renderPreview() {
      const preview = document.getElementById('preview-card');
      if (!id) {
        preview.textContent = '불러올 카드가 없습니다.';
        return;
      }
      const snap = await getDoc(doc(db, 'selectedCards', id));
      if (!snap.exists()) {
        preview.textContent = '카드를 찾을 수 없습니다.';
        return;
      }
      const card = snap.data();

      preview.innerHTML = `
        <div class="task-bubble fixed">
          <div class="card-back">
            <div class="tag">#${card.분류}</div>
            <h2>${card.과제제목}</h2>
            <div class="border"></div>
            <div class="detail-group">
              <div class="box">
                <h4>문제점</h4>
                <p>${card.문제점}</p>
              </div>
              <div class="box">
                <h4>사용자니즈</h4>
                <p>${card.사용자니즈}</p>
              </div>
              <div class="box">
                <h4>해결전략</h4>
                <p>${card.UX해결전략1}</p>
              </div>
              <div class="box">
                <h4>추천 UI</h4>
                <p>${card.UX해결전략1_추천UI}</p>
              </div>
              <div class="box">
                <h4>참고사례</h4>
                <p>${card.UX해결전략1_참고사례}</p>
              </div>
            </div>
          </div>
        </div>`;
    }

    // 4) 다중 이미지 업로드 & 미리보기
    const dropzone  = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');

    // 드래그 스타일링
    ['dragenter','dragover'].forEach(evt =>
      dropzone.addEventListener(evt, e => {
        e.preventDefault();
        dropzone.classList.add('dragover');
      })
    );
    ['dragleave','drop'].forEach(evt =>
      dropzone.addEventListener(evt, e => {
        e.preventDefault();
        dropzone.classList.remove('dragover');
      })
    );

    // 클릭 시 파일창 열기
    dropzone.addEventListener('click', () => fileInput.click());

    // 드롭 시 파일 설정
    dropzone.addEventListener('drop', e => {
      fileInput.files = e.dataTransfer.files;
      handleFiles();
    });

    // 파일 선택 시 처리
    fileInput.addEventListener('change', handleFiles);

    function handleFiles() {
      const files = Array.from(fileInput.files);
      // 이전 미리보기 제거
      dropzone.querySelectorAll('img.preview').forEach(img => img.remove());
      dropzone.querySelector('.placeholder').style.display = 'none';

      files.forEach(file => {
        if (!file.type.startsWith('image/')) return;
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement('img');
          img.className = 'preview';
          img.src = e.target.result;
          dropzone.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    }

    // 5) 제출 버튼 예시
    function submitSolution() {
      alert('이미지 파일 업로드와 과제 설명 작성여부를 확인하세요.');
    }

    window.addEventListener('DOMContentLoaded', renderPreview);
  </script>
</body>
</html>
