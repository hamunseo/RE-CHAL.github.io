<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UX 과제 카드</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <div class="nav-bar">
      <img src="image/logo.png" alt="로고" class="logo">
      <ul class="menu">
        <li><a href="#">챌린지</a></li>
        <li><a href="#">라이브러리</a></li>
        <li><a href="#">프로필페이지</a></li>
      </ul>
    </div>

    <h1 class="page-title">네이버지도 챌린지</h1>

    <!-- 카드가 배치될 영역 -->
    <div class="card-container" id="cardContainer"></div>
  </div>

  <script>
    // 1) API 키 요청
    const APIkey = prompt("OpenAI API Key를 입력하세요");

    // 2) 페이지 로드 시 실행
    window.addEventListener("DOMContentLoaded", fetchAndRenderCards);

    async function fetchAndRenderCards() {
      const promptText = `
        당신은 UX/UI 실무 경험을 갖춘 전문가이며, 디자인 전공 학생을 교육하는 교육자입니다.

[조건]
입력된 실제 사용자 리뷰 데이터를 분석하여, 사용자 불편을 기반으로 한 UX/UI 문제를 도출해라.
단순 오류, 기술 결함, 데이터 오류 등은 제외한다.
문제는 반드시 UX 리서치 및 UI 설계로 해결 가능한 수준이어야 하며,
반복적으로 나타나는 문제를 우선적으로 다룬다.
도출된 문제들은 다음의 5가지 사용성 기준에 따라 분류하여 제공한다.
각 분류에 해당하는 과제가 없다면 해당 항목은 생략한다.

[요청]
**최소 5개**의 JSON 과제 객체를 배열 형태로 반환하십시오.  
설명은 절대 포함하지 말고, 순수 JSON 배열만 내려주세요.

[사용자 리뷰 데이터]
"잘 이용하고 있는데 최근 앱이 이상합니다. 식당을 찾아서 세부 정보를 보려고 클릭하고..."
(생략)

[
  {
    "분류": "사용 효율성",
    "과제 제목": "즐겨찾기 접근성 향상",
    "문제점": "즐겨찾기한 장소를 홈에서 바로 접근할 수 없음",
    "사용자 니즈": "자주 사용하는 장소를 빠르게 찾고 싶어함",
    "UX 해결 전략 1": "홈 화면에 즐겨찾기 섹션 고정",
    "UX 해결 전략 2": "검색 시 즐겨찾기 우선 노출"
  }
  ...
]
      `;

      try {
        // 3.1 API 호출
        const res = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${APIkey}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [
              { role: "system", content: "너는 UX 디자이너이며 사용자 리뷰를 분석해 UX 과제 카드들을 도출하는 전문가야." },
              { role: "user", content: promptText }
            ],
            temperature: 0.7
          })
        });

        const data = await res.json();
        const raw = (data.choices[0].message.content || "").trim();

        // 3.2 JSON 배열만 추출 (dotall 지원)
        const match = raw.match(/\[[\s\S]*\]/);
        if (!match) {
          console.error("JSON 배열을 찾을 수 없습니다:", raw);
          return;
        }

        const cards = JSON.parse(match[0]);
        console.log("cards.length:", cards.length, cards);

        // 3.3 카드 컨테이너 초기화
        const container = document.getElementById("cardContainer");
        container.innerHTML = "";

        // 3.4 전통적인 for문으로 카드 생성
        for (let i = 0; i < cards.length; i++) {
          const card = cards[i];
          const bubble = document.createElement("div");
          bubble.className = "task-bubble";

          // 랜덤 배치 (가로 10~80%, 세로 15~70%)
          bubble.style.left = `${10 + Math.random() * 70}%`;
          bubble.style.top  = `${15 + Math.random() * 60}%`;

          // 내부 HTML 세팅
          bubble.innerHTML =
            '<div class="card-front">' + card["과제 제목"] + '</div>' +
            '<div class="card-back">' +
              '<span class="tag">#' + card["분류"] + '</span>' +
              '<h2>' + card["과제 제목"] + '</h2>' +
              '<div class="box"><h4>문제점</h4><p>' + card["문제점"] + '</p></div>' +
              '<div class="box"><h4>사용자 니즈</h4><p>' + card["사용자 니즈"] + '</p></div>' +
            '</div>';

          // 클릭 토글(고정/해제)
          bubble.addEventListener("click", function(e) {
            e.stopPropagation();
            bubble.classList.toggle("fixed");
          });

          container.appendChild(bubble);
        }

      } catch (err) {
        console.error("카드 생성 중 오류:", err);
        alert("카드 생성에 실패했습니다.");
      }
    }
  </script>
</body>
</html>
